package mailaddr

import (
	"fmt"
	"net/mail"
	"strings"
	"testing"
)

func TestParseAddressList(t *testing.T) {
	for k, v := range map[string]struct {
		In   string
		Want []mail.Address
	}{
		"naked":  {In: "tamas@gulacsi.eu", Want: []mail.Address{{Address: "tamas@gulacsi.eu"}}},
		"angled": {In: "<tamas@gulacsi.eu>", Want: []mail.Address{{Address: "tamas@gulacsi.eu"}}},
		"named":  {In: "\"Tamás Gulácsi\" <tamas@gulacsi.eu>", Want: []mail.Address{{Name: "Tamás Gulácsi", Address: "tamas@gulacsi.eu"}}},
		"two": {In: "Tamás Gulácsi <tgulacsi78@gmail.com>, Gulácsi-Bárdos Petra Panna, Dr. <petrabardos@gmail.com>",
			Want: []mail.Address{{Name: "Tamás Gulácsi", Address: "tgulacsi78@gmail.com"},
				{Name: "Gulácsi-Bárdos Petra Panna, Dr.", Address: "petrabardos@gmail.com"}}},
		"nakeNamed":   {In: "Tamás Gonosz Gulácsi tamas@gulacsi.eu <tamas@gulacsi.eu>", Want: []mail.Address{{Name: "Tamás Gonosz Gulácsi tamas_at_gulacsi.eu", Address: "tamas@gulacsi.eu"}}},
		"singleQuote": {In: "'Tamás Gulácsi' <tamas@gulacsi.eu>", Want: []mail.Address{{Name: "'Tamás Gulácsi'", Address: "tamas@gulacsi.eu"}}},

		"long": {In: "Adler György <gyorgyadler@t-online.hu>, Adlerné S. Anikó <adlerne@freemail.hu>, \"Anna Marietta\" <marietta.anna62@gmail.com>, \"Attila Toldi\" <cafelutyo@gmail.com>, \"Balatoni Henrik\" <balatonihenrik@gmail.com>, Balázsi Győző <GYOZO.BALAZSI@hotmail.com>, Bedros Róbert <drbedros@drbedros.hu>, Blazsovits Éva <info@sasadiovi.hu>, Bóna Eszter <mihuxsi@gmail.com>, Bóna Eszter párja <benebator@gmail.com>, Bőr Tamás Szécsi Julianna <dermavet@t-online.hu>, \"Czibula Katalin\" <czibula.katalin@gmail.com>, Csapó Zita <csapo@daruline.hu>, Cseh Tiborné <tiborne.cseh@groupama.hu>, Csilling László <laszlo@csilling.com>, Eszter Molnár <eszter0316@gmail.com>, Gábor Szomolányi <szomolg@gmail.com>, Gack Józsefné <gack.jozsefne@datatrain.hu>, Gulácsi Tamás <gt-siofok@gthomas.eu>, \"Hermann Tibor\" <hermann@stanctechnik.hu>, \"Hermann Tibor\" <info@stanctechnik.hu>, <ikalman@msn.com>, Ildikó Kószó <koszoildi10@gmail.com>, Jex Gábor <JexG@modusz.hu>, Kálmán Mónika <kalman.monika@otpeletjaradek.hu>, Kaló Orsolya <kaloors@gmail.com>, \"kaman karoly\" <karoly.kaman@gmail.com>, \"Kis Alice\" <alice@oraesekszerhaz.t-online.hu>, \"Klara Schneider\" <schneider.klarika@gmail.com>, Kollárik Éva <enagyova@yahoo.com>, \"Koszta Veronika\" <verula21@gmail.com>, Kovács István <istkov@freemail.hu>, Kováts András <andras.kovats@keletterv.hu>, Kuglics József <nbd6970@gmail.com>, Lassan György <lassan.gyorgy20@gmail.com>, Leitner György <gyorgy.l.leitner@gmail.com>, Magyari László <magyari@daruline.hu>, Márta T.Vajda <tothvajda.marta@gmail.com>, Melinda Tóth <t.rezmelinda@gmail.com>, Mórocz-Schmitz Irén <irmoschmitz@gmail.com>, Nagy Gáborné Nagy Tamás <ng0130@gmail.com>, Nagy Tamás <nt71@citromail.hu>, Nagy Zoltán <magdolna.nagyne@gmail.com>, Nyikus Éva <evi@csilling.com>, \"ordog.istvan\" <ordog.istvan@upcmail.hu>, OTP Életjáradék <info@otpeletjaradek.hu>, Perneczky Tamás t. perneczky@gmail. com <t.perneczky@gmail.com>, Pethes Nóra <tariek@t-online.hu>, \"Pethes Olga\" <pethes.olga@chello.hu>, Rácz Zsuzsanna <razsuzsanna@gmail.com>, Ruff János <Ruff@iveco-levantex.hu>, <seri@seri.hu>, Skivraha Éva <skivrahae@t-online.hu>, Stefán György <stgeorge108@gmail.com>, Szabó Ervin <szaboervin@gmail.com>, Szabó Tímea <timi2141@freemail.hu>, Szabó Zoltán <szabo@sysinforg.hu>, \"Szalay Judit\" <judit@szalay-family.hu>, Szécsi Julianna <szjulcsi123@gmail.com>, Szente János <52jszente@gmail.com>, Tamás Miklós <elnok@citytaxi.hu>, Toldi Imréné <toldiimre@t-online.hu>, Toth Tamás <totht.tamas66@gmail.com>, Urbancsok Tamás <t.urbancsok@gmail.com>, \"Urbancsok Zsuzsanna\" <urbancsokzsuzsi@gmail.com>, Varga József B67 <vargajp63@gmail.com>, Vida László <vida.bt@citromail.hu>, Vödrös Anikó <vodros.aniko@gmail.com>, 'Lajos Gyócsi' <lui6567@gmail.com>",
			Want: []mail.Address{{Name: "Adler György", Address: "gyorgyadler@t-online.hu"}, {Name: "Adlerné S. Anikó", Address: "adlerne@freemail.hu"}, {Name: "Anna Marietta", Address: "marietta.anna62@gmail.com"}, {Name: "Attila Toldi", Address: "cafelutyo@gmail.com"}, {Name: "Balatoni Henrik", Address: "balatonihenrik@gmail.com"}, {Name: "Balázsi Győző", Address: "GYOZO.BALAZSI@hotmail.com"}, {Name: "Bedros Róbert", Address: "drbedros@drbedros.hu"}, {Name: "Blazsovits Éva", Address: "info@sasadiovi.hu"}, {Name: "Bóna Eszter", Address: "mihuxsi@gmail.com"}, {Name: "Bóna Eszter párja", Address: "benebator@gmail.com"}, {Name: "Bőr Tamás Szécsi Julianna", Address: "dermavet@t-online.hu"}, {Name: "Czibula Katalin", Address: "czibula.katalin@gmail.com"}, {Name: "Csapó Zita", Address: "csapo@daruline.hu"}, {Name: "Cseh Tiborné", Address: "tiborne.cseh@groupama.hu"}, {Name: "Csilling László", Address: "laszlo@csilling.com"}, {Name: "Eszter Molnár", Address: "eszter0316@gmail.com"}, {Name: "Gábor Szomolányi", Address: "szomolg@gmail.com"}, {Name: "Gack Józsefné", Address: "gack.jozsefne@datatrain.hu"}, {Name: "Gulácsi Tamás", Address: "gt-siofok@gthomas.eu"}, {Name: "Hermann Tibor", Address: "hermann@stanctechnik.hu"}, {Name: "Hermann Tibor", Address: "info@stanctechnik.hu"}, {Name: "", Address: "ikalman@msn.com"}, {Name: "Ildikó Kószó", Address: "koszoildi10@gmail.com"}, {Name: "Jex Gábor", Address: "JexG@modusz.hu"}, {Name: "Kálmán Mónika", Address: "kalman.monika@otpeletjaradek.hu"}, {Name: "Kaló Orsolya", Address: "kaloors@gmail.com"}, {Name: "kaman karoly", Address: "karoly.kaman@gmail.com"}, {Name: "Kis Alice", Address: "alice@oraesekszerhaz.t-online.hu"}, {Name: "Klara Schneider", Address: "schneider.klarika@gmail.com"}, {Name: "Kollárik Éva", Address: "enagyova@yahoo.com"}, {Name: "Koszta Veronika", Address: "verula21@gmail.com"}, {Name: "Kovács István", Address: "istkov@freemail.hu"}, {Name: "Kováts András", Address: "andras.kovats@keletterv.hu"}, {Name: "Kuglics József", Address: "nbd6970@gmail.com"}, {Name: "Lassan György", Address: "lassan.gyorgy20@gmail.com"}, {Name: "Leitner György", Address: "gyorgy.l.leitner@gmail.com"}, {Name: "Magyari László", Address: "magyari@daruline.hu"}, {Name: "Márta T.Vajda", Address: "tothvajda.marta@gmail.com"}, {Name: "Melinda Tóth", Address: "t.rezmelinda@gmail.com"}, {Name: "Mórocz-Schmitz Irén", Address: "irmoschmitz@gmail.com"}, {Name: "Nagy Gáborné Nagy Tamás", Address: "ng0130@gmail.com"}, {Name: "Nagy Tamás", Address: "nt71@citromail.hu"}, {Name: "Nagy Zoltán", Address: "magdolna.nagyne@gmail.com"}, {Name: "Nyikus Éva", Address: "evi@csilling.com"}, {Name: "ordog.istvan", Address: "ordog.istvan@upcmail.hu"}, {Name: "OTP Életjáradék", Address: "info@otpeletjaradek.hu"}, {Name: "Perneczky Tamás t. perneczky_at_gmail. com", Address: "t.perneczky@gmail.com"}, {Name: "Pethes Nóra", Address: "tariek@t-online.hu"}, {Name: "Pethes Olga", Address: "pethes.olga@chello.hu"}, {Name: "Rácz Zsuzsanna", Address: "razsuzsanna@gmail.com"}, {Name: "Ruff János", Address: "Ruff@iveco-levantex.hu"}, {Name: "", Address: "seri@seri.hu"}, {Name: "Skivraha Éva", Address: "skivrahae@t-online.hu"}, {Name: "Stefán György", Address: "stgeorge108@gmail.com"}, {Name: "Szabó Ervin", Address: "szaboervin@gmail.com"}, {Name: "Szabó Tímea", Address: "timi2141@freemail.hu"}, {Name: "Szabó Zoltán", Address: "szabo@sysinforg.hu"}, {Name: "Szalay Judit", Address: "judit@szalay-family.hu"}, {Name: "Szécsi Julianna", Address: "szjulcsi123@gmail.com"}, {Name: "Szente János", Address: "52jszente@gmail.com"}, {Name: "Tamás Miklós", Address: "elnok@citytaxi.hu"}, {Name: "Toldi Imréné", Address: "toldiimre@t-online.hu"}, {Name: "Toth Tamás", Address: "totht.tamas66@gmail.com"}, {Name: "Urbancsok Tamás", Address: "t.urbancsok@gmail.com"}, {Name: "Urbancsok Zsuzsanna", Address: "urbancsokzsuzsi@gmail.com"}, {Name: "Varga József B67", Address: "vargajp63@gmail.com"}, {Name: "Vida László", Address: "vida.bt@citromail.hu"}, {Name: "Vödrös Anikó", Address: "vodros.aniko@gmail.com"}, {Name: "'Lajos Gyócsi'", Address: "lui6567@gmail.com"}},
		},
		"mueller": {In: "\"akos.korpaczy@groupama.hu\" <akos.korpaczy@groupama.hu>, Pus Attila <attila.pus@allianz.hu>, Nágel Balázs <balazs.nagel@idomsoft.hu>, \"Bali.Gabor@aegon.hu\" <Bali.Gabor@aegon.hu>, BARBARA PÁL <barbara.pal@kh.hu>, Biró Domokos <Biro.Domokos@mpb.hu>, \"Borbely.Zoltan@aegon.hu\" <Borbely.Zoltan@aegon.hu>, \"Busa.Zoltan@aegon.hu\" <Busa.Zoltan@aegon.hu>, CSABA KAPITÁNY <Csaba.Kapitany@kh.hu>, Csató Anikó <csato.aniko@cig.eu>, Harsányi-Czeininger Enikő <Czeininger.Eniko@signal.hu>, Czibula Szilveszter <Czibula.Szilveszter@union.hu>, Edina Juhász <edina.juhasz@uniqa.hu>, Fábián Gábor <Fabian.Gabor@union.hu>, Flamich Gábor <Flamich.Gabor@signal.hu>, Hagyó Gábor <Gabor.Hagyo@generali.com>, Töreky Gábor <gabor.toreky@allianz.hu>, Vörös Gabriella <gabriella.v oros@allianz.hu>, \"gajda.tunde@aegon.hu\" <gajda.tunde@aegon.hu>, Vörös Gyula <gyula.voros@idomsoft.hu>, \"Horvath.Imre@aegon.hu\" <Horvath.Imre@aegon.hu>, István Halupka <istvan.halupka@uniqa.hu>, \"dr. Paulik Ivett\" <Ivett.Paulik@idomsoft.hu>, \"janos.magyar@groupama.hu\" <janos.magyar@groupama.hu>, Csaba József <jozsef.csaba@generali.com>, \"jozsef.szilagyi@mabisz.hu\" <jozsef.szilagyi@mabisz.hu>, Salamon-Herbert Judit <Judit.Salamon-Herbert@idomsoft.hu>, \"Kocsis.Attila@aegon.hu\" <Kocsis.Attila@aegon.hu>, Surányi Krisztina <krisztina.suranyi@genertel.hu>, Vajda László <laszlo.2.vajda@allianz.hu>, \"laszlo.csiszar@groupama.hu\" <laszlo.csiszar@groupama.hu>, László Katalin <Laszlo.Katalin@signal.hu>, \"Laszlo.Szeberenyi@groupama.hu\" <Laszlo.Szeberenyi@groupama.hu>, Magda Zsanett <Magda.Zsanett@union.hu>, Makray Judit <makrayj@kobe.hu>, Orovecz Mária <maria.orovecz@idomsoft.hu>, Rajcsányi Mária <maria.rajcsanyi@idomsoft.hu>, Dr. Svecz Mária <maria.svecz@mabisz.hu>, \"Megyeri.Gabor@aegon.hu\" <Megyeri.Gabor@aegon.hu>, \"Mueller.PeterGyoergy@aegon.hu\" <Mu eller.PeterGyoergy@aegon.hu>, Szőke Noémi <noemi.szoke@allianz.hu>, ELEK NORBERT SMIRI <Norbert.Smiri@kh.hu>, \"Pasztor-Turak.Laszlo@aegon.hu\" <Pasztor-Turak.Laszlo@aegon.hu>, VASS Péter <Peter.Vass@qualysoft.com>, Pétery Zoltán <Petery.Zoltan@mpb.hu>, Rétlaki Máté <retlaki.mate@cig.eu>, Schmidt Győző <Schmidt.Gyozo@union.hu>, \"Sebestyen.Andras@aegon.hu\" <Sebestyen.Andras@aegon.hu>, Szántai Gabriella <szantai.gabriella@wabererbiztosito.hu>, \"Szombat.Tamas@aegon.hu\" <Szombat.Tamas@aegon.hu>, Gulácsi Tamás <T.Gulacsi@unosoft.hu>, TAMÁS TÓSZEGI <tamas.toszegi@kh.hu>, Virág Fehér <virag.feher@uniqa.hu>, Zsolt Béki <zsolt.beki@uniqa.hu>, Hegedűs Zsolt <Zsolt.Hegedus@generali.com>, Zsuppán Zoltán <Zsuppan.Zoltan@signal.hu>",
			Want: []mail.Address{{Address: "akos.korpaczy@groupama.hu", Name: "akos.korpaczy_at_groupama.hu"}, {Address: "attila.pus@allianz.hu", Name: "Pus Attila"}, {Address: "balazs.nagel@idomsoft.hu", Name: "Nágel Balázs"}, {Address: "Bali.Gabor@aegon.hu", Name: "Bali.Gabor_at_aegon.hu"}, {Address: "barbara.pal@kh.hu", Name: "BARBARA PÁL"}, {Address: "Biro.Domokos@mpb.hu", Name: "Biró Domokos"}, {Address: "Borbely.Zoltan@aegon.hu", Name: "Borbely.Zoltan_at_aegon.hu"}, {Address: "Busa.Zoltan@aegon.hu", Name: "Busa.Zoltan_at_aegon.hu"}, {Address: "Csaba.Kapitany@kh.hu", Name: "CSABA KAPITÁNY"}, {Address: "csato.aniko@cig.eu", Name: "Csató Anikó"}, {Address: "Czeininger.Eniko@signal.hu", Name: "Harsányi-Czeininger Enikő"}, {Address: "Czibula.Szilveszter@union.hu", Name: "Czibula Szilveszter"}, {Address: "edina.juhasz@uniqa.hu", Name: "Edina Juhász"}, {Address: "Fabian.Gabor@union.hu", Name: "Fábián Gábor"}, {Address: "Flamich.Gabor@signal.hu", Name: "Flamich Gábor"}, {Address: "Gabor.Hagyo@generali.com", Name: "Hagyó Gábor"}, {Address: "gabor.toreky@allianz.hu", Name: "Töreky Gábor"}, {Address: "gabriella.voros@allianz.hu", Name: "Vörös Gabriella"}, {Address: "gajda.tunde@aegon.hu", Name: "gajda.tunde_at_aegon.hu"}, {Address: "gyula.voros@idomsoft.hu", Name: "Vörös Gyula"}, {Address: "Horvath.Imre@aegon.hu", Name: "Horvath.Imre_at_aegon.hu"}, {Address: "istvan.halupka@uniqa.hu", Name: "István Halupka"}, {Address: "Ivett.Paulik@idomsoft.hu", Name: "dr. Paulik Ivett"}, {Address: "janos.magyar@groupama.hu", Name: "janos.magyar_at_groupama.hu"}, {Address: "jozsef.csaba@generali.com", Name: "Csaba József"}, {Address: "jozsef.szilagyi@mabisz.hu", Name: "jozsef.szilagyi_at_mabisz.hu"}, {Address: "Judit.Salamon-Herbert@idomsoft.hu", Name: "Salamon-Herbert Judit"}, {Address: "Kocsis.Attila@aegon.hu", Name: "Kocsis.Attila_at_aegon.hu"}, {Address: "krisztina.suranyi@genertel.hu", Name: "Surányi Krisztina"}, {Address: "laszlo.2.vajda@allianz.hu", Name: "Vajda László"}, {Address: "laszlo.csiszar@groupama.hu", Name: "laszlo.csiszar_at_groupama.hu"}, {Address: "Laszlo.Katalin@signal.hu", Name: "László Katalin"}, {Address: "Laszlo.Szeberenyi@groupama.hu", Name: "Laszlo.Szeberenyi_at_groupama.hu"}, {Address: "Magda.Zsanett@union.hu", Name: "Magda Zsanett"}, {Address: "makrayj@kobe.hu", Name: "Makray Judit"}, {Address: "maria.orovecz@idomsoft.hu", Name: "Orovecz Mária"}, {Address: "maria.rajcsanyi@idomsoft.hu", Name: "Rajcsányi Mária"}, {Address: "maria.svecz@mabisz.hu", Name: "Dr. Svecz Mária"}, {Address: "Megyeri.Gabor@aegon.hu", Name: "Megyeri.Gabor_at_aegon.hu"}, {Address: "Mueller.PeterGyoergy@aegon.hu", Name: "Mueller.PeterGyoergy_at_aegon.hu"}, {Address: "noemi.szoke@allianz.hu", Name: "Szőke Noémi"}, {Address: "Norbert.Smiri@kh.hu", Name: "ELEK NORBERT SMIRI"}, {Address: "Pasztor-Turak.Laszlo@aegon.hu", Name: "Pasztor-Turak.Laszlo_at_aegon.hu"}, {Address: "Peter.Vass@qualysoft.com", Name: "VASS Péter"}, {Address: "Petery.Zoltan@mpb.hu", Name: "Pétery Zoltán"}, {Address: "retlaki.mate@cig.eu", Name: "Rétlaki Máté"}, {Address: "Schmidt.Gyozo@union.hu", Name: "Schmidt Győző"}, {Address: "Sebestyen.Andras@aegon.hu", Name: "Sebestyen.Andras_at_aegon.hu"}, {Address: "szantai.gabriella@wabererbiztosito.hu", Name: "Szántai Gabriella"}, {Address: "Szombat.Tamas@aegon.hu", Name: "Szombat.Tamas_at_aegon.hu"}, {Address: "T.Gulacsi@unosoft.hu", Name: "Gulácsi Tamás"}, {Address: "tamas.toszegi@kh.hu", Name: "TAMÁS TÓSZEGI"}, {Address: "virag.feher@uniqa.hu", Name: "Virág Fehér"}, {Address: "zsolt.beki@uniqa.hu", Name: "Zsolt Béki"}, {Address: "Zsolt.Hegedus@generali.com", Name: "Hegedűs Zsolt"}, {Address: "Zsuppan.Zoltan@signal.hu", Name: "Zsuppán Zoltán"}},
		},
	} {
		k, v := k, v
		t.Run(k, func(t *testing.T) {
			got, err := ParseAddressList(v.In)
			if err != nil {
				t.Error(err)
			}
			if got, want := len(got), len(v.Want); got != want {
				t.Errorf("got %d, wanted %d addresses", got, want)
			}
			var buf strings.Builder
			buf.WriteString("[]mail.Address{")
			for i, g := range got {
				var w mail.Address
				if len(v.Want) > i {
					w = v.Want[i]
				}
				if g.Address != w.Address {
					t.Errorf("%d.Address got %q, wanted %q", i, g.Address, w.Address)
				}
				if g.Name != w.Name {
					t.Errorf("%d.Name got %q, wanted %q", i, g.Name, w.Name)
				}

				fmt.Fprintf(&buf, "{Address:%q,Name:%q}, ", g.Address, g.Name)
			}
			buf.WriteString("}")
			t.Log(buf.String())
		})
	}
}
